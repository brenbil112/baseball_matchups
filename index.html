<script>
  const fetchButton = document.getElementById('fetchButton');
  const teamSelect = document.getElementById('teamSelect');
  const resultsTable = document.getElementById('resultsTable').querySelector('tbody');

  fetchButton.addEventListener('click', () => {
    const teamId = teamSelect.value;
    if (!teamId) {
      alert('Please select a team.');
      return;
    }

    const today = new Date();
    const startDate = today.toISOString().split('T')[0];
    const endDateObj = new Date(today);
    endDateObj.setDate(today.getDate() + 7); // Look ahead 7 days
    const endDate = endDateObj.toISOString().split('T')[0];

    const proxyUrl = 'https://corsproxy.io/?';
    const targetUrl = `https://statsapi.mlb.com/api/v1/schedule?sportId=1&hydrate=probablePitcher&startDate=${startDate}&endDate=${endDate}`;
    const url = proxyUrl + encodeURIComponent(targetUrl);

    fetch(url)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        const games = data.dates.flatMap(date => date.games);

        const teamGames = games.filter(game =>
          game.teams.away.team.id == teamId || game.teams.home.team.id == teamId
        ).slice(0, 3); // Only next 3 games

        resultsTable.innerHTML = ''; // Clear previous results

        if (teamGames.length === 0) {
          resultsTable.innerHTML = '<tr><td colspan="4">No games found for the selected team.</td></tr>';
          return;
        }

        teamGames.forEach(game => {
          const isHome = game.teams.home.team.id == teamId;
          const opponentInfo = isHome ? game.teams.away : game.teams.home;

          const opponentName = opponentInfo.team.name;

          const opponentPitcher = opponentInfo.probablePitcher
            ? opponentInfo.probablePitcher.fullName
            : 'TBD';

          const handedness = opponentInfo.probablePitcher && opponentInfo.probablePitcher.pitchHand
            ? opponentInfo.probablePitcher.pitchHand.code
            : 'TBD';

          const row = `
            <tr>
              <td>${game.gameDate.split('T')[0]}</td>
              <td>${opponentName}</td>
              <td>${opponentPitcher}</td>
              <td>${handedness}</td>
            </tr>
          `;
          resultsTable.innerHTML += row;
        });
      })
      .catch(error => {
        console.error('Error fetching games:', error);
        alert('Something went wrong. Please try again.');
      });
  });
</script>
